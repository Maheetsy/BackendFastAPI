# --- 1. CREAR EL ENTORNO ---
# (Abre la terminal en la carpeta del proyecto, ej: BackendFastApi)

# 1.1. Crea el entorno virtual (si no existe)
python -m venv venv

# 1.2. Activa el entorno (¡SIEMPRE ANTES DE TRABAJAR!)
.\venv\Scripts\activate

# 1.3. Prepara 'requirements.txt' (Usa PyMySQL, es más fácil)
fastapi
uvicorn[standard]
sqlalchemy
pydantic
pydantic-settings
PyMySQL  <-- (Usa este en lugar de mysqlclient)

# 1.4. Instala las librerías
pip install -r requirements.txt

# --- 2. CONFIGURAR LA BASE DE DATOS ---

# 2.1. Crea la Base de Datos manualmente en phpMyAdmin
#    - Nombre: pos_db (o el que decidas)
#    - Cotejamiento: utf8mb4_general_ci

# 2.2. Crea el archivo '.env' (en la raíz del proyecto)
# (¡Asegúrate de que JWT_SECRET sea IDÉNTICO al del backend de Node.js!)
DATABASE_URL=mysql+pymysql://root:@127.0.0.1:3306/pos_db
JWT_SECRET=tu-clave-secreta-larga-y-compartida
jwt_expires_in=1d

# --- 3. REVISAR PUNTOS CLAVE DEL CÓDIGO ---

# 3.1. app/config.py
#    - Asegúrate de que la clase 'Settings' incluye 'database_url',
#      'jwt_secret', y 'jwt_expires_in'.

# 3.2. app/database.py
#    - Asegúrate de que importa 'settings' de '.config'.

# 3.3. app/models/product.py (¡ERROR CLÁSICO!)
#    - Importa 'func' de 'sqlalchemy.sql'.
#    - Define las fechas así:
#      created_at = Column(TIMESTAMP, server_default=func.now())
#      updated_at = Column(TIMESTAMP, server_default=func.now(), onupdate=func.now())

# 3.4. app/schemas/*.py (¡ERROR CLÁSICO!)
#    - En 'class Config', usa 'from_attributes = True' (no 'orm_mode').

# 3.5. app/__init__.py y app/models/__init__.py (¡ERROR CLÁSICO!)
#    - Asegúrate de que los archivos '__init__.py' importan y
#      exponen las clases de sus sub-módulos.

# 3.6. app/main.py
#    - Importa 'Base' desde 'database' (no 'models').
#    - Importa los módulos de modelos (ej: 'from .models import product, category')
#      *ANTES* de llamar a 'Base.metadata.create_all(bind=engine)'.
#    - Asegúrate de añadir el Middleware de CORS.
#    - Asegúrate de incluir los routers (product_router, category_router).

# --- 4. EJECUTAR Y PROBAR ---

# 4.1. Ejecuta el servidor (con el 'venv' activo)
uvicorn app.main:app --reload

# 4.2. Abre el navegador en: http://127.0.0.1:8000/docs

# 4.3. Prueba la seguridad (¡EL GRAN PASO!)
#    - Primero, obtén un Token JWT desde tu Backend de Node.js (usando Postman).
#    - En la página de /docs, haz clic en el botón [Authorize].
#    - En el popup, escribe 'Bearer ' (seguido de un espacio) y pega tu token.
#    - Ahora ya puedes probar los endpoints protegidos (como POST /products).